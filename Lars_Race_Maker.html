
<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: #2b2b2b;
        }

        #myCanvas {
            background-color: #2b2b2b;
        }

        #out {
            color: white;
        }
    </style>
</head>

<img id = "scream" width = "420" height = 1360 src = "First_City_HUD_debug.jpg" alt = "The Scream" style = "display:none;">

<canvas id = "myCanvas" width = "420" height = "1360 style = "background-color: #2b2b2b;">
Your browser does not support the HTML5 canvas tag.

</canvas>

<div id = "out"></div>

<script>

var MIN_X = -200.0;
var MAX_X = 220.0;
var MIN_Z = -1000.0;
var MAX_Z = 360.0;

var coords = [
[0.0, 0.0, 77.5, 0, 20.0, 0.0, 0.0, 0.0, 0.0],
[0, 0, 0, 0, 20.0, 0.0, 0.0, 0.0, 0.0],
[0.0, 0.0, -100.0, 0, 20.0, 0.0, 0.0, 0.0, 0.0],
[95.0, 0.0, -110.0, 0, 20.0, 0.0, 0.0, 0.0, 0.0],
[40.0, 0.0, 100.0, 0, 20.0, 0.0, 0.0, 0.0, 0.0],
[0.0, 245.0, -850.0, 0, 20.0, 0.0, 0.0, 0.0, 0.0]
];

function mapRange(value, in_min, in_max, out_min, out_max) {
    return (value - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}

window.onload = function() {
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    var img = document.getElementById("scream");
    
    // Draw the image onto the canvas
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    for (var i = 0; i < coords.length; i++) {
        ctx.lineWidth = "10";
        ctx.strokeStyle = "blue";
        ctx.beginPath();

        // Mapping the coordinates to fit within the canvas dimensions
        let mappedX = mapRange(coords[i][0], MIN_X, MAX_X, 0, canvas.width);
        let mappedZ = mapRange(coords[i][2], MIN_Z, MAX_Z, 0, canvas.height);

        ctx.arc(mappedX, mappedZ, 5, 0, 2 * Math.PI);
        ctx.fill();

    }
};

let last = null;

function getCursorPosition(canvas, event) {
    const rect = canvas.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;
    console.log("x: " + x + " y: " + y);
    let closest = [-1, 10000000000];
    for (var i = 0; i < coords.length; i++) {
        let mappedX = mapRange(coords[i][0], MIN_X, MAX_X, 0, canvas.width);
        let mappedZ = mapRange(coords[i][2], MIN_Z, MAX_Z, 0, canvas.height);
        
        let dist = (x - mappedX)**2 + (y - mappedZ)**2;
        if (closest[1] > dist) {
            closest = [i, dist];
        }
    }
    if (closest[1] < 500) {
        document.getElementById("out").innerHTML += coords[closest[0]].join(',');
        document.getElementById("out").innerHTML += '<br/>';
        if (last) {
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");
            ctx.lineWidth = "5";
            ctx.strokeStyle = "blue";
            ctx.beginPath();
            ctx.moveTo(last[0], last[1]);
            ctx.lineTo(x, y);
            ctx.stroke();
        }
        last = [x,y];
    }
}
    
const canvas = document.getElementById('myCanvas');
canvas.addEventListener('mousedown', function(e) {
    getCursorPosition(canvas, e);
});
</script>
</body>
</html>
    